{% extends 'core/base.html' %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- Main Profile Card -->
  <div class="lg:col-span-2">
    <div class="bg-white rounded-2xl shadow-sm p-8">
      <div class="flex items-start justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Profile</h2>
        <button class="p-2 hover:bg-gray-50 rounded-lg transition">
          <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
        </button>
      </div>

      <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
        <!-- Avatar -->
        <div class="relative">
          {% if user.studentprofile.profile_picture %}
            <img src="{{ user.studentprofile.profile_picture.url }}" alt="{{ user.username }}" class="w-24 h-24 rounded-full object-cover shadow-md ring-4 ring-purple-100">
          {% else %}
            <div class="w-24 h-24 rounded-full bg-gradient-to-br from-purple-400 to-blue-400 flex items-center justify-center shadow-md ring-4 ring-purple-100">
              <span class="text-4xl font-bold text-white">{{ user.username|slice:":1"|upper }}</span>
            </div>
          {% endif %}
          <div class="absolute bottom-0 right-0 w-6 h-6 bg-green-400 rounded-full border-4 border-white"></div>
        </div>

        <!-- Info -->
        <div class="flex-1 text-center md:text-left">
          <h3 class="text-2xl font-bold text-gray-800">{{ user.studentprofile.full_name|default:user.username }}</h3>
          <p class="text-sm text-gray-500 mt-1">
            {% if user.studentprofile.grade %}Grade {{ user.studentprofile.grade }}{% else %}Student{% endif %} • Active learner
          </p>
          
          <!-- User Details -->
          <div class="mt-4 space-y-2 text-sm text-gray-600">
            <div class="flex items-center gap-2 justify-center md:justify-start">
              <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
              </svg>
              <span>@{{ user.username }}</span>
            </div>
            <div class="flex items-center gap-2 justify-center md:justify-start">
              <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
              </svg>
              <span>{{ user.email }}</span>
            </div>
            {% if user.studentprofile.birthday %}
            <div class="flex items-center gap-2 justify-center md:justify-start">
              <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
              </svg>
              <span>{{ user.studentprofile.birthday|date:"F d, Y" }}</span>
              {% if user.studentprofile.age %}
                <span class="text-gray-400">•</span>
                <span>{{ user.studentprofile.age }} years old</span>
              {% endif %}
            </div>
            {% endif %}
          </div>
          
          <div class="mt-4 flex flex-wrap gap-2 justify-center md:justify-start">
            <span class="px-3 py-1 bg-purple-50 text-purple-600 rounded-full text-xs font-medium">Rooted Explorer</span>
            <span class="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-xs font-medium">Quiz Master</span>
          </div>

          <div class="mt-6 grid grid-cols-3 gap-4">
            <div class="text-center">
              <div class="text-2xl font-bold text-gray-800">2</div>
              <div class="text-xs text-gray-500 mt-1">Completed</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-gray-800">5</div>
              <div class="text-xs text-gray-500 mt-1">In Progress</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-gray-800">3</div>
              <div class="text-xs text-gray-500 mt-1">Downloads</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Account Information -->
    <div class="mt-6 bg-white rounded-2xl shadow-sm p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-gray-800">Account Information</h3>
        <a href="{% url 'core:change_password' %}" class="text-sm text-purple-600 hover:text-purple-700 font-medium">Change Password</a>
      </div>
      <div class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Full Name</label>
            <p class="text-sm text-gray-800 font-medium">{{ user.studentprofile.full_name|default:"Not set" }}</p>
          </div>
          <div>
            <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Username</label>
            <p class="text-sm text-gray-800 font-medium">{{ user.username }}</p>
          </div>
          <div>
            <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Email Address</label>
            <p class="text-sm text-gray-800 font-medium">{{ user.email|default:"Not set" }}</p>
          </div>
          <div>
            <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Grade Level</label>
            <p class="text-sm text-gray-800 font-medium">
              {% if user.studentprofile.grade %}Grade {{ user.studentprofile.grade }}{% else %}Not set{% endif %}
            </p>
          </div>
          <div>
            <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Birthday</label>
            <p class="text-sm text-gray-800 font-medium">
              {% if user.studentprofile.birthday %}{{ user.studentprofile.birthday|date:"F d, Y" }}{% else %}Not set{% endif %}
            </p>
          </div>
          <div>
            <label class="block text-xs font-semibold text-gray-500 uppercase mb-1">Age</label>
            <p class="text-sm text-gray-800 font-medium">
              {% if user.studentprofile.age %}{{ user.studentprofile.age }} years old{% else %}Not set{% endif %}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Overview -->
    <div class="mt-6 bg-white rounded-2xl shadow-sm p-6">
      <h3 class="text-lg font-bold text-gray-800 mb-4">Learning Progress</h3>
      <div class="space-y-4">
        <div>
          <div class="flex justify-between text-sm mb-2">
            <span class="text-gray-600">Overall Completion</span>
            <span class="font-semibold text-gray-800">40%</span>
          </div>
          <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-purple-400 to-purple-600 rounded-full" style="width: 40%"></div>
          </div>
        </div>
        <div>
          <div class="flex justify-between text-sm mb-2">
            <span class="text-gray-600">Quiz Score Average</span>
            <span class="font-semibold text-gray-800">4.5</span>
          </div>
          <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-blue-400 to-blue-600 rounded-full" style="width: 90%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="space-y-6">
    <!-- Calendar Widget -->
    <div class="bg-white rounded-2xl shadow-sm p-6" x-data="{
      currentDate: new Date(),
      selectedDate: new Date(),
      
      get monthName() {
        return this.currentDate.toLocaleString('default', { month: 'long' });
      },
      
      get year() {
        return this.currentDate.getFullYear();
      },
      
      get daysInMonth() {
        return new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 0).getDate();
      },
      
      get firstDayOfMonth() {
        return new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), 1).getDay();
      },
      
      get calendarDays() {
        const days = [];
        const blanks = this.firstDayOfMonth;
        const totalDays = this.daysInMonth;
        
        // Add blank days before month starts
        for (let i = 0; i < blanks; i++) {
          days.push({ day: '', isEmpty: true });
        }
        
        // Add actual days
        for (let day = 1; day <= totalDays; day++) {
          days.push({ 
            day: day, 
            isEmpty: false,
            isToday: this.isToday(day),
            isSelected: this.isSelectedDay(day)
          });
        }
        
        return days;
      },
      
      isToday(day) {
        const today = new Date();
        return day === today.getDate() && 
               this.currentDate.getMonth() === today.getMonth() && 
               this.currentDate.getFullYear() === today.getFullYear();
      },
      
      isSelectedDay(day) {
        return day === this.selectedDate.getDate() && 
               this.currentDate.getMonth() === this.selectedDate.getMonth() && 
               this.currentDate.getFullYear() === this.selectedDate.getFullYear();
      },
      
      previousMonth() {
        this.currentDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() - 1, 1);
      },
      
      nextMonth() {
        this.currentDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 1);
      },
      
      selectDay(day) {
        if (day) {
          this.selectedDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), day);
        }
      },
      
      goToToday() {
        this.currentDate = new Date();
        this.selectedDate = new Date();
      }
    }">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-gray-800">Activity Calendar</h3>
        <button @click="goToToday()" class="text-xs px-2 py-1 text-purple-600 hover:bg-purple-50 rounded transition">
          Today
        </button>
      </div>
      
      <div class="text-center">
        <!-- Month/Year Navigation -->
        <div class="flex items-center justify-between mb-3">
          <button @click="previousMonth()" class="p-1 hover:bg-gray-100 rounded transition">
            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          </button>
          
          <div class="text-sm font-semibold text-gray-700">
            <span x-text="monthName"></span> <span x-text="year"></span>
          </div>
          
          <button @click="nextMonth()" class="p-1 hover:bg-gray-100 rounded transition">
            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </button>
        </div>
        
        <!-- Calendar Grid -->
        <div class="grid grid-cols-7 gap-1 text-xs">
          <!-- Day Headers -->
          <div class="text-gray-400 font-medium py-2">S</div>
          <div class="text-gray-400 font-medium py-2">M</div>
          <div class="text-gray-400 font-medium py-2">T</div>
          <div class="text-gray-400 font-medium py-2">W</div>
          <div class="text-gray-400 font-medium py-2">T</div>
          <div class="text-gray-400 font-medium py-2">F</div>
          <div class="text-gray-400 font-medium py-2">S</div>
          
          <!-- Calendar Days -->
          <template x-for="dayData in calendarDays" :key="dayData.day + Math.random()">
            <div 
              @click="selectDay(dayData.day)"
              :class="{
                'bg-purple-500 text-white font-semibold shadow-md': dayData.isToday,
                'bg-purple-100 text-purple-700 font-medium': dayData.isSelected && !dayData.isToday,
                'hover:bg-gray-100 cursor-pointer': !dayData.isEmpty && !dayData.isToday,
                'text-gray-300': dayData.isEmpty
              }"
              class="aspect-square flex items-center justify-center rounded transition-all duration-200">
              <span x-text="dayData.day"></span>
            </div>
          </template>
        </div>
        
        <!-- Activity Indicator -->
        <div class="mt-4 pt-4 border-t border-gray-100">
          <div class="flex items-center justify-center gap-4 text-xs text-gray-500">
            <div class="flex items-center gap-1">
              <div class="w-3 h-3 bg-purple-500 rounded"></div>
              <span>Today</span>
            </div>
            <div class="flex items-center gap-1">
              <div class="w-3 h-3 bg-purple-100 rounded"></div>
              <span>Selected</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="bg-white rounded-2xl shadow-sm p-6">
      <h3 class="text-lg font-bold text-gray-800 mb-4">Recent Activity</h3>
      <div class="space-y-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
              <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-gray-800 truncate">Completed quiz</p>
            <p class="text-xs text-gray-500">2 hours ago</p>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"></path>
            </svg>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-gray-800 truncate">Started lesson</p>
            <p class="text-xs text-gray-500">Yesterday</p>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-orange-50 flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-gray-800 truncate">Downloaded guide</p>
            <p class="text-xs text-gray-500">3 days ago</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
