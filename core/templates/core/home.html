{% extends 'core/base.html' %}

{% block content %}
  <section class="relative overflow-hidden rounded-lg p-6 bg-gradient-to-br from-[color:var(--cream)] to-white shadow-md">
    <div class="flex flex-col gap-6">
      <!-- Slideshow / Carousel -->
      <div x-data="{ idx: 0, length: {{ featured|length }} }" x-init="setInterval(()=>{ idx = (idx+1) % (length||1) }, 5000)" class="w-full">
        <div class="relative bg-white rounded-lg overflow-hidden shadow">
          <template x-for="(i, j) in Array(length).fill().map((_,k)=>k)" :key="j">
            <div x-show="idx === j" x-transition.duration.500ms class="p-6 flex flex-col md:flex-row items-center gap-6">
              <div class="flex-1">
                <!-- fetch data from Django rendered list by index using JS interpolation -->
                {% comment %} Alpine can't access Django list directly; render items as hidden markup for JS to pick up {% endcomment %}
                <h2 x-text="document.getElementById('slide-title-'+j).textContent" class="text-3xl font-extrabold"></h2>
                <p x-text="document.getElementById('slide-excerpt-'+j).textContent" class="mt-3 text-gray-700"></p>
                <div class="mt-6 flex gap-3">
                  <a :href="document.getElementById('slide-url-'+j).value" class="px-4 py-2 rounded bg-[color:var(--leaf)] text-white">Read lesson</a>
                  <a href="/festival-tour/" class="px-4 py-2 rounded border border-[color:var(--leaf)] text-[color:var(--leaf)]">Festival Tour</a>
                </div>
              </div>
              <div class="w-full md:w-56 h-40 bg-gray-100 rounded flex items-center justify-center text-5xl">üç™</div>
            </div>
          </template>

          <!-- pagination dots -->
          <div class="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-2">
            <template x-for="n in length" :key="n">
              <button @click="idx = $index" :class="{'bg-[color:var(--leaf)]': idx === $index, 'bg-white': idx !== $index} " class="w-3 h-3 rounded-full border"></button>
            </template>
          </div>
        </div>

        <!-- Render slide data into page for Alpine to read via DOM (hidden) -->
        <div class="hidden">
          {% for a in featured %}
            <h3 id="slide-title-{{ forloop.counter0 }}">{{ a.title|escape }}</h3>
            <div id="slide-excerpt-{{ forloop.counter0 }}">{{ a.excerpt|default_if_none:''|escape }}</div>
            <input type="hidden" id="slide-url-{{ forloop.counter0 }}" value="/lessons/{{ a.slug }}/" />
          {% endfor %}
        </div>
      </div>

      <!-- Intro / CTA area below slideshow -->
      <div class="p-4">
        <h2 class="text-3xl font-extrabold">Celebrate the Sweet Heritage of Bustos</h2>
        <p class="mt-3 text-gray-700">Discover how a humble root grew into a cultural treasure ‚Äî videos, stories, recipes, and interactive quizzes for Grades 6‚Äì10. Browse lessons, take short quizzes, or join the festival tour. You can explore most content without signing up; create an account to save progress and earn badges.</p>
        <div class="mt-6 flex gap-3">
          <a href="/lessons/" class="px-4 py-2 rounded bg-[color:var(--leaf)] text-white">Start Learning</a>
          <a href="/accounts/signup/" class="px-4 py-2 rounded border border-[color:var(--leaf)] text-[color:var(--leaf)]">Sign up</a>
        </div>
      </div>
    </div>
  </section>

  <section class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="p-4 bg-white rounded shadow" data-aos="fade-up">
      <h3 class="font-semibold">Planting & Science</h3>
      <p class="text-sm text-gray-600 mt-2">Learn how arrowroot grows and why it's important for soil and livelihood.</p>
      <a href="/lessons/" class="mt-3 inline-block text-sm text-[color:var(--leaf)]">Explore lessons ‚Üí</a>
    </div>
    <div class="p-4 bg-white rounded shadow" data-aos="fade-up" data-aos-delay="80">
      <h3 class="font-semibold">Festival Tour</h3>
      <p class="text-sm text-gray-600 mt-2">A scroll-based virtual tour of stalls and stages from Bustos' Minasa Festival.</p>
      <a href="/festival-tour/" class="mt-3 inline-block text-sm text-[color:var(--leaf)]">Take the tour ‚Üí</a>
    </div>
    <div class="p-4 bg-white rounded shadow" data-aos="fade-up" data-aos-delay="160">
      <h3 class="font-semibold">Quizzes & Challenges</h3>
      <p class="text-sm text-gray-600 mt-2">Short games and quizzes to test your knowledge ‚Äî badges and progress tracking included.</p>
      <a href="/quizzes/" class="mt-3 inline-block text-sm text-[color:var(--leaf)]">Try a quiz ‚Üí</a>
    </div>
  </section>

  <section class="mt-10">
    <h3 class="text-xl font-semibold">Featured Lessons</h3>
    <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
      {% for a in featured %}
        <article class="bg-white rounded p-4 shadow" data-aos="zoom-in">
          <h4 class="font-semibold">{{ a.title }}</h4>
          <p class="text-sm text-gray-600 mt-2">{{ a.excerpt }}</p>
          <a href="/lessons/{{ a.slug }}/" class="mt-3 inline-block text-[color:var(--leaf)]">Read more</a>
        </article>
      {% empty %}
        <p>No featured lessons yet. Add some via admin.</p>
      {% endfor %}
    </div>
  </section>

{% endblock %}
